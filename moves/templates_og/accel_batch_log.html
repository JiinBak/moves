<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Accelerometer Javascript Test</title>
<meta name="viewport" content="width=device-width,user-scalable=yes" />
<style>
body {
	font-family: helvetica, arial, sans serif;
}

</style>
</head>

<body>
<div id="content">
    <h1>Model training</h1>




<input type="text" size="25" name="activity1">
<a href="javascript:void(0);" id="start_activity_1">Train activity #1</a>
<span id='activity_1_complete'></span>
<br>
<br>

<input type="text" size="25" name="activity2">
<a href="javascript:void(0);" id="start_activity_2">Train activity #2</a>
<span id='activity_2_complete'></span>
<br>
<br>


<input type="text" size="25" name="activity3">
<a href="javascript:void(0);" id="start_activity_3">Train activity #3</a>
<span id='activity_3_complete'></span>

<br>
<br>
<a href="javascript:void(0);" id="train_model">Build the model</a>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script type="text/javascript" src="http://smoothiecharts.org/smoothie.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">

<script type="text/javascript">

var x = 0 ,  y = 0,
    vx = 0, vy = 0,
	ax = 0, ay = 0;
	
if (window.DeviceMotionEvent != undefined) {
	window.ondevicemotion = function(e) {
		ax = event.accelerationIncludingGravity.x;
		ay = event.accelerationIncludingGravity.y;
		az = event.accelerationIncludingGravity.z
		document.getElementById("accelerationX").innerHTML = e.accelerationIncludingGravity.x;
		document.getElementById("accelerationY").innerHTML = e.accelerationIncludingGravity.y;
		document.getElementById("accelerationZ").innerHTML = e.accelerationIncludingGravity.z;
	}

    var socket = io.connect('http://' + document.domain + ':' + location.port);
    var accel_data = [];

    //setTimeout(function() {document.getElementById("accel_data").innerHTML = accel_data;}, 4000)

    recordTime = 5*1000
    //create json output
    function event2json(label) {
        return {'data':true,
        'channel':1111111111,
        'data_type':'training',
        'timestamp':Date.now(),
        'label':label,
        'orientation':{'x':null,'y':null,'z':null},
        'motion':{'x':ax,'y':ay,'z':az}
        };
    };

    function logData(labelName,recordTime,elementID) { 
        var dataInterval = setInterval( function() {
        //accel_data.push(az)
        //accel_data.push(Math.random())
        ax = Math.random()
        ay = Math.random()
        az = Math.random()
        accel_data.push(event2json(labelName))
        }, 67)
        setTimeout(function() {
                clearInterval(dataInterval);
                document.getElementById(elementID).innerHTML = '&#9989;';
                }
        ,recordTime);
    };

    $('a#start_activity_1').bind('click', function() {
        logData('label1',recordTime,'activity_1_complete');
    });

    $('a#start_activity_2').bind('click', function() {
        logData('label2',recordTime,'activity_2_complete');
    });

    $('a#start_activity_3').bind('click', function() {
        logData('label3',recordTime,'activity_3_complete');
    });

    $('a#train_model').bind('click', function() {
    socket.emit('streaming_data',{message :accel_data});
    });
     
     
} 
</script>

</body>
</html>

